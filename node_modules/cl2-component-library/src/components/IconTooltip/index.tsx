import React, { memo, ReactChild, FC } from 'react';
import Tippy from '@tippyjs/react';
import styled from 'styled-components';
import { darken } from 'polished';
import Icon, { IconNames } from '../Icon';
import { colors } from '../../utils/styleUtils';
import testEnv from '../../utils/testUtils/testEnv';
import Box, {
  BoxPositionProps,
  BoxMarginProps,
  BoxPaddingProps,
  BoxVisibilityProps,
  BoxDisplayProps,
  BoxZIndexProps,
} from '../Box';

const ContentWrapper = styled.div<{ tippytheme: 'light' | undefined }>`
  padding: 5px;

  a {
    color: ${(props) =>
      props.tippytheme === 'light' ? colors.clBlueDark : colors.clBlueLighter};
    text-decoration: underline;
    overflow-wrap: break-word;
    word-wrap: break-word;
    word-break: break-all;
    word-break: break-word;
    hyphens: auto;

    &:hover {
      color: ${(props) =>
        darken(
          0.15,
          props.tippytheme === 'light'
            ? colors.clBlueDark
            : colors.clBlueLighter
        )};
      text-decoration: underline;
    }
  }
`;

const TooltipIcon = styled(Icon)<{
  iconColor: string | undefined;
  iconHoverColor: string | undefined;
  iconSize: string | undefined;
}>`
  width: ${({ iconSize }) => iconSize};
  height: ${({ iconSize }) => iconSize};
  fill: ${({ iconColor }) => iconColor || colors.label};
  cursor: pointer;

  &:hover {
    fill: ${({ iconColor, iconHoverColor }) =>
      iconHoverColor ||
      (iconColor ? darken(0.2, iconColor) : darken(0.2, colors.label))};
  }
`;

export type Props = {
  className?: string;
  content: ReactChild;
  icon?: IconNames;
  placement?:
    | 'auto-start'
    | 'auto'
    | 'auto-end'
    | 'top-start'
    | 'top'
    | 'top-end'
    | 'right-start'
    | 'right'
    | 'right-end'
    | 'bottom-end'
    | 'bottom'
    | 'bottom-start'
    | 'left-end'
    | 'left'
    | 'left-start';
  theme?: 'light';
  iconSize?: string;
  iconColor?: string;
  iconHoverColor?: string;
  maxTooltipWidth?: number;
  iconAriaTitle?: string;
} & BoxPositionProps &
  BoxMarginProps &
  BoxPaddingProps &
  BoxVisibilityProps &
  BoxDisplayProps &
  BoxZIndexProps;

const IconTooltip: FC<Props> = memo<Props>(
  ({
    content,
    icon,
    placement,
    theme,
    iconSize,
    iconColor,
    iconHoverColor,
    maxTooltipWidth,
    iconAriaTitle,
    className,
    ...rest
  }) => {
    return (
      <Tippy
        interactive={true}
        placement={placement || 'right-end'}
        theme={theme || ''}
        maxWidth={maxTooltipWidth || 350}
        content={
          <ContentWrapper id="tooltip-content" tippytheme={theme}>
            {content}
          </ContentWrapper>
        }
      >
        <Box
          as="button"
          className={`${className || ''} tooltip-icon`}
          aria-describedby="tooltip-content"
          data-testid={testEnv('tooltip-icon-button')}
          p="0px"
          {...rest}
        >
          <TooltipIcon
            name={icon || 'info3'}
            iconSize={iconSize || '17px'}
            iconColor={iconColor}
            iconHoverColor={iconHoverColor}
            title={iconAriaTitle}
          />
        </Box>
      </Tippy>
    );
  }
);

export default IconTooltip;
